{% extends "tasker/layout.html" %}

{% block body %}
<div class="container-task-form edit-task">
    <div class="task-form">
        <h2>Edit Task: {{ task.name }}</h2>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                {{ form.name.label_tag }}
                {{ form.name }}
            </div>
            <div class="form-group">
                {{ form.description.label_tag }}
                {{ form.description }}
            </div>
            <div class="form-group">
                {{ form.date_to_complete.label_tag }}
                {{ form.date_to_complete }}
            </div>
            <div class="form-group">
                {{ form.size.label_tag }}
                {{ form.size }}
            </div>
            <div class="form-group">
                {{ form.priority.label_tag }}
                {{ form.priority }}
            </div>
            <div class="form-group">
                {{ form.status.label_tag }}
                {{ form.status }}
            </div>
            <div class="form-group">
                <label for="id_tags">Tags:</label>
                <div class="tag-container">
                    {% for tag in form.tags.field.queryset %}
                        <label class="tag-label" data-color="{{ tag.color }}" style="display: flex; align-items: center; gap: 8px; padding: 5px 10px; border-radius: 6px; margin-right: 5px; color: white;">
                            <input type="checkbox" name="tags" value="{{ tag.id }}" {% if tag in form.instance.tags.all %}checked{% endif %} style="margin: 0; width: unset;">
                            <span>{{ tag.name }}</span>
                        </label>
                    {% endfor %}
                </div>
                <!-- <div class="tag-creation">
                    <input type="text" id="new-tag-name" class="tag-input" placeholder="New tag name">
                    <input type="color" id="new-tag-color" class="color-picker" value="#000000">
                    <button type="button" class="btn btn-sm btn-secondary" onclick="addTag()">Add Tag</button>
                </div> -->
            </div>
            <button type="submit" class="btn btn-success">Save Changes</button>
            <a href="{% url 'task_list' %}" class="btn btn-secondary" style="margin-top: 15px;">Cancel</a>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".tag-label").forEach(function(label) {
            let color = label.getAttribute("data-color");
            if (color) {
                label.style.backgroundColor = color;
            }
        });
    });

    // function addTag() {
    //     let tagName = document.getElementById("new-tag-name").value;
    //     let tagColor = document.getElementById("new-tag-color").value;

    //     fetch("/tasks/add_tag/", {
    //         method: "POST",
    //         headers: {
    //             "X-CSRFToken": "{{ csrf_token }}",
    //             "Content-Type": "application/json"
    //         },
    //         body: JSON.stringify({ name: tagName, color: tagColor })
    //     })
    //     .then(response => response.json())
    //     .then(data => {
    //         if (data.success) {
    //             let container = document.querySelector(".tag-container");

    //             let label = document.createElement("label");
    //             label.className = "tag-label";
    //             label.setAttribute("data-color", tagColor);
    //             label.style.backgroundColor = tagColor;
    //             label.style.display = "flex";
    //             label.style.alignItems = "center";
    //             label.style.gap = "8px";
    //             label.style.padding = "5px 10px";
    //             label.style.borderRadius = "6px";
    //             label.style.marginRight = "5px";
    //             label.style.color = "white";

    //             let checkbox = document.createElement("input");
    //             checkbox.type = "checkbox";
    //             checkbox.name = "tags";
    //             checkbox.value = data.tag_id;
    //             checkbox.checked = true;
    //             checkbox.style.margin = "0";

    //             let span = document.createElement("span");
    //             span.textContent = tagName;

    //             label.appendChild(checkbox);
    //             label.appendChild(span);
    //             container.appendChild(label);
    //         } else {
    //             alert(data.error);
    //         }
    //     });
    // }
</script>

{% endblock %}